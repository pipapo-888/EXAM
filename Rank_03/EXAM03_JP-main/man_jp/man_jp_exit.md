EXIT(3) — Linux Programmer’s Manual
名前（NAME）

exit — 通常のプロセス終了を行う

書式（SYNOPSIS）
#include <stdlib.h>

void exit(int status);

説明（DESCRIPTION）

exit() 関数は、通常のプロセス終了を行う。
status 引数の下位 1 バイト（すなわち status & 0xFF）が、
親プロセスに返される（wait(2) 参照）。

atexit(3) および on_exit(3) によって登録されたすべての関数が、
登録の逆順で呼び出される。
（これらの関数の1つが atexit(3) または on_exit(3) を用いて
追加の関数を登録した場合、その新しい登録は残りの呼び出しリストの先頭に追加される。）

これらの登録関数のいずれかが戻らない場合（例：_exit(2) の呼び出しや
シグナルによる自己終了）、残りの登録関数は呼ばれず、
以降の終了処理（特に stdio(3) ストリームのフラッシュ処理）は中断される。

同じ関数が複数回登録されていた場合は、登録回数分だけ呼び出される。

すべての stdio(3) ストリームはフラッシュされ、閉じられる。
tmpfile(3) により作成された一時ファイルは削除される。

C 標準では、終了状態を示す定数として EXIT_SUCCESS および EXIT_FAILURE が定義されており、
これらを exit() に渡すことで、成功または失敗の終了を明示できる。

返り値（RETURN VALUE）

exit() 関数は戻り値を返さない。

属性（ATTRIBUTES）
インタフェース	属性	値
exit()	スレッド安全性	MT-Unsafe race:exit

exit() 関数は保護されていないグローバル変数を使用するため、スレッドセーフではない。

準拠（CONFORMING TO）

POSIX.1-2001, POSIX.1-2008, C89, C99, SVr4, 4.3BSD。

注記（NOTES）

atexit(3) または on_exit(3) により登録された関数のいずれかが
exit() や longjmp(3) を呼び出した場合、その動作は未定義である。

また、execve(2) を呼び出すと、atexit(3) および on_exit(3) による登録はすべて解除される。

EXIT_SUCCESS および EXIT_FAILURE の使用は、0 や 1、-1 といった
数値値を直接使用するよりも非 UNIX 系環境で移植性が高い。
特に VMS などでは異なる終了コード規約が使用されている。

BSD では終了コードの標準化を試みており、GNU C ライブラリなどもこれを採用している。
詳細は <sysexits.h> を参照。

プロセス終了後の状態

exit() 呼び出し後、終了状態は親プロセスに伝達される。
以下の3つの場合がある：

親が SA_NOCLDWAIT を設定している、または SIGCHLD ハンドラを SIG_IGN にしている場合：
終了状態は破棄され、子プロセスは即座に消滅する。

親が待機中（wait(2) 系呼び出しを実行中）の場合：
終了状態が通知され、子プロセスは直ちに消滅する。

それ以外の場合：
子プロセスは「ゾンビ」状態となる。
プロセスリソースの大部分は解放されるが、終了状態やリソース使用統計などの最小情報が
プロセステーブルに残される。
親が waitpid(2) などを呼び出すことでこの情報を取得すると、ゾンビスロットは解放される。

SIGCHLD シグナルをサポートする実装では、
このシグナルが親プロセスに送られる。
ただし、親が SA_NOCLDWAIT を設定している場合、
シグナルが送信されるかどうかは未定義である。

他プロセスへのシグナル送信

終了するプロセスがセッションリーダであり、
その制御端末がセッションの制御端末である場合：
制御端末のフォアグラウンドプロセスグループ内のすべてのプロセスに
SIGHUP シグナルが送信され、端末はこのセッションから切り離され、
新しい制御プロセスに取得可能となる。

また、プロセスの終了によってプロセスグループが孤立した場合（orphaned process group）、
そのグループ内に停止状態のプロセスがある場合には、
SIGHUP に続いて SIGCONT シグナルが送られる。
詳細は setpgid(2) を参照。

上記のケースを除き、プロセスの終了は通常、その子プロセスにシグナルを送らない。
ただし、prctl(2) の PR_SET_PDEATHSIG 操作を用いて、
親が終了した際にシグナルを受け取るよう設定することができる。

関連項目（SEE ALSO）

_exit(2), get_robust_list(2), setpgid(2), wait(2),
atexit(3), on_exit(3), tmpfile(3)

コロフォン（COLOPHON）

このページは Linux man-pages プロジェクト リリース 5.10 の一部である。
プロジェクトの説明、バグ報告、および最新版の入手方法については：
https://www.kernel.org/doc/man-pages/

解説（実務的補足）

exit() と _exit() の違い
_exit() は stdio バッファのフラッシュや atexit() 登録関数の呼び出しを行わずに
直ちにプロセスを終了する。子プロセスやエラーハンドラ内で使用されることが多い。

スレッド安全性
exit() はグローバル変数を更新するためスレッドセーフではない。
マルチスレッドプログラムでは、他スレッドが同時に exit() を呼ばないよう同期を取る必要がある。

ゾンビプロセスの回避
デーモンプログラムなどでは SIGCHLD を SIG_IGN に設定し、
子プロセス終了時にゾンビが発生しないようにするのが一般的。

終了コードの慣習
成功：EXIT_SUCCESS (0)
一般的なエラー：EXIT_FAILURE (1)
BSD 準拠の詳細な終了コードは <sysexits.h> に定義されている。